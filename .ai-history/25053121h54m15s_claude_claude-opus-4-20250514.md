# What is the behaviour of the code if no agent host is set and no system instructions file is found?

I would like to know the behavior of the code when no `xxx_agent_host` is set and no system instructions file (`.ai-system-instructions.md`) is found.
Specifically, what happens in that case?





# This is claude-opus-4-20250514 answer (14k in, 0k out)

Looking at the code, here's what happens when no agent host is set and no system instructions file is found:

## 1. **When no agent hosts are set** (empty strings for `anthropic_agent_host`, `googleai_agent_host`, `openai_agent_host`):

The code falls back to using the direct API endpoints instead of the agent hosts. In `lua/ai/init.lua`:

```lua
-- Lines 92-95 determine which mode to use
local use_anthropic_agent = M.opts.anthropic_agent_host ~= ''
local use_googleai_agent = M.opts.googleai_agent_host ~= ''
local use_openai_agent = M.opts.openai_agent_host ~= ''

-- Lines 103-145: If ANY agent host is not set, it uses direct API calls
if (number_of_files == 0 or not use_anthropic_agent or not use_googleai_agent or not use_openai_agent) then
    common.log("Not using agents")
    -- Calls the regular ask() function for each provider
    anthropic.ask(...)  -- Uses https://api.anthropic.com
    googleai.ask(...)   -- Uses https://generativelanguage.googleapis.com
    openai.ask(...)     -- Uses https://api.openai.com
```

## 2. **When no system instructions file is found**:

The `aiconfig.getSystemInstructions()` function returns an empty string:

```lua
-- In lua/ai/aiconfig.lua
function aiconfig.getSystemInstructions()
  local path = aiconfig.findSystemInstructionsFile()
  if path == "" then
    return ""  -- Returns empty string when file not found
  end
  -- ...
end
```

## 3. **Combined behavior**:

When both conditions are true (no agent hosts and no system instructions file):

1. **The popup shows only the loading message** - no file list is displayed (lines 97-102)
2. **Direct API calls are made** to each provider (Anthropic, Google AI, OpenAI)
3. **An empty string is passed as the system instruction** to each API
4. **The prompt sent to the APIs consists only of the user's input** without any system-level context

This means the AI models will receive minimal context - just the user's prompt without any project-specific instructions or file contents. The models will respond based on their default behavior without any customization.

The key difference is that without agent hosts, the plugin cannot use the "heavy" mode that includes project file contents in the context, even if a `.ai-scanned-files` configuration exists.

