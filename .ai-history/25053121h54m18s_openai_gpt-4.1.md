# What is the behaviour of the code if no agent host is set and no system instructions file is found?

I would like to know the behavior of the code when no `xxx_agent_host` is set and no system instructions file (`.ai-system-instructions.md`) is found.
Specifically, what happens in that case?





# This is gpt-4.1 answer (11k in, 0k out)

Let's break down the behavior of your code when:

- **No agent host is set** (i.e., `anthropic_agent_host`, `googleai_agent_host`, `openai_agent_host` are all empty strings)
- **No system instructions file** (`.ai-system-instructions.md`) is found in the project root

## 1. System Instructions File

### Where is it used?
- In `aiconfig.getSystemInstructions()`, which is called in `M.handle()` in `lua/ai/init.lua`.

### What happens if the file is missing?
- `aiconfig.findSystemInstructionsFile()` returns `""` if the file is not found.
- `aiconfig.getSystemInstructions()` then returns `""` (an empty string).

**Result:**  
The system instructions passed to the model will be an empty string.

---

## 2. Agent Host Not Set

### Where is it used?
- In `M.handle()` in `lua/ai/init.lua`:
  ```lua
  local use_anthropic_agent = M.opts.anthropic_agent_host ~= ''
  local use_googleai_agent = M.opts.googleai_agent_host ~= ''
  local use_openai_agent = M.opts.openai_agent_host ~= ''
  ```
- The code then checks:
  ```lua
  if (number_of_files == 0 or not use_anthropic_agent or not use_googleai_agent or not use_openai_agent ) then
      -- use the "normal" (non-agent) ask() functions
  else
      -- use the askHeavy() functions (agent hosts)
  end
  ```

### What happens if all agent hosts are empty?
- All `use_xxx_agent` variables are `false`.
- The code will **always** use the "normal" (non-agent) `ask()` functions for each provider (Anthropic, GoogleAI, OpenAI).
- The "heavy" agent-based workflow is **not used**.

---

## 3. What is sent to the models?

- The prompt is constructed as usual.
- The system instructions are an empty string (since the file is missing).
- The "normal" API endpoints are used (not the agent hosts).
- The prompt and empty system instructions are sent to the models.

---

## 4. User Experience

- The user will see the popup as usual.
- The models will answer the prompt, but **without any system instructions** (unless the prompt itself includes context).
- The models are called directly via their public APIs, not via any custom agent.

---

## 5. Summary Table

| Condition                        | Behavior                                                                 |
|-----------------------------------|--------------------------------------------------------------------------|
| No agent host set                 | Uses direct API calls (`ask()`), not `askHeavy()`                        |
| No system instructions file found | System instructions are empty string (`""`)                              |
| Result                           | Models answer prompt, but with no system instructions, via direct API    |

---

## 6. Code Path Example

- User runs a command (e.g., `AIIntroduceYourself`)
- `M.handle()` is called
- `aiconfig.getSystemInstructions()` returns `""`
- All `use_xxx_agent` are `false`
- Calls `anthropic.ask()`, `googleai.ask()`, `openai.ask()` with:
  - `model` (from config)
  - `instruction = ""`
  - `prompt` (from command)
  - `api_key` (from config)
- The models respond as usual, but with no system instructions.

---

## 7. Potential Issues

- If your prompts rely on system instructions for context or behavior, the models may behave less predictably or generically.
- If you want to enforce a default system instruction, you may want to add a fallback in your code.

---

**In summary:**  
If no agent host is set and no system instructions file is found, the plugin will use the direct API endpoints for each provider, and the system instructions sent to the models will be empty. The models will answer the prompt as usual, but without any extra context or instructions.

